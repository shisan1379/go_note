# Secret

Secret 是在 Kubernetes 中专门存储敏感数据的资源，能安全存放密码、令牌密钥等信息，避免敏感数据明文暴露在配置文件或镜像中


# 核心特性

1. **敏感数据管理** ： 专门存储密码、API 令牌 、SSH 密钥等敏感信息
2. **编码存储** ： 数据会被 BASE64编码
3. **访问控制** ： 可以通过 RBAC 控制谁能访问 Secret
4. **动态更新** ： 可以在不重新部署Pod的情况下更新 Secret
5. **体积限制** ： 单个 Secret 大小限制为 1MB

# Secret的类型


1. **Opaque** ： 默认类型，用于存储任意敏感数据
2. **kubernetes.io/service-acount-tokn** ：用于服务账户令牌
3. **kubernetes.io/dockercfg** : 用于存储 docker 仓库认证信息
4. **kubernetes.io/dockerconfigjson** ：新版本docker 仓库认证信息
5. **kubernetes.io/basic-auth** ：用于基本身份认证
6. **kubernetes.io/ssh-auth** ：用于 SSH 认证
7. **kubernetes.io/tls** ：用于存储 TLS 证书和私钥

# Secret 的使用方式


## 创建 Secret

### 通过 yaml 文件创建

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=  # 这是 "admin" 的 Base64 编码
  password: cGFzc3dvcmQxMjM=  # 这是 "password123" 的 Base64 编码
```

### 通过命令行创建

```bash
# 从字面量创建
kubectl create secret generic mysecret --from-literal=username=admin --from-literal=password=password123

# 从文件创建
kubectl create secret generic mysecret --from-file=./username.txt --from-file=./password.txt
kubectl create secret tls whoami-tls --cert=tls.crt --key=tls.key


# 创建 docker 仓库认证信息
kubectl create secret docker-registry regcred --docker-server=<your-registry-server> --docker-username=<your-name> --docker-password=<your-pword> --docker-email=<your-email>
```



## 在 Pod 中使用 Secret


### 作为环境变量使用
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: secret-env-pod
spec:
  containers:
  - name: mycontainer
    image: busybox
    command: ['sh', '-c', 'echo "Username: $SECRET_USERNAME, Password: $SECRET_PASSWORD" && sleep 3600']
    env:
      - name: SECRET_USERNAME
        valueFrom:
          secretKeyRef:
            name: mysecret
            key: username
      - name: SECRET_PASSWORD
        valueFrom:
          secretKeyRef:
            name: mysecret
            key: password
  restartPolicy: Never
```

### 作为文件挂载使用

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: secret-volume-pod
spec:
  containers:
  - name: mycontainer
    image: busybox
    command: ['sh', '-c', 'cat /etc/secret-volume/username && cat /etc/secret-volume/password && sleep 3600']
    volumeMounts:
    - name: secret-volume
      mountPath: /etc/secret-volume
      readOnly: true
  volumes:
  - name: secret-volume
    secret:
      secretName: mysecret
  restartPolicy: Never
```


### 部分挂载 Secret

```yaml
volumes:
- name: secret-volume
  secret:
    secretName: mysecret
    items:
    - key: username
      path: my-group/my-username
      mode: 0400
```

## 查看和管理 Secret

```bash
# 查看所有 Secret
kubectl get secrets

# 查看特定 Secret 的详细信息
kubectl describe secret mysecret

# 解码查看 Secret 的内容
kubectl get secret mysecret -o jsonpath='{.data.username}' | base64 --decode
kubectl get secret mysecret -o jsonpath='{.data.password}' | base64 --decode

# 删除 Secret
kubectl delete secret mysecret
```








