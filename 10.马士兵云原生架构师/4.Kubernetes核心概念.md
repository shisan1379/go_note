


# kubernetes 核心概念


## Pod


Pod 是可以在Kubernetes 中创建和管理的、最小的可部署的计算单元

Pod 其中包含着一组（一个或多个）容器；这些容器共享存储、网络平以及怎样运行这些容器的声明。

Pod 就像一台物理服务器一样，包含一个或多个应用容器，这些容器中运行着用户应用程序。

`Pod[ Container[应用程序，应用程序]，Container[应用程序，应用程序]]`

## Controller


Controller 是在 Kubernetes 中用于管理和运行 Pod 的对象。

在 Kubernetes 中，控制器通过监控集群的公共状态，并致力于将当前状态转变为期望状态。

一个控制器至少追踪一种类型的 Kubernetes 资源，这些对象有一个代表期望状态的 spec 字段，该控制器负责确保其当前状态接近期望状态。

不同类型的控制器所实现的控制方式不一样，例如：

- **deployment： 部署无状态应用**
  - 部署无状态应用：认为 pod 都一样，没有顺序要求，不用考虑在哪个node运行，随意进行扩展和伸缩
  - 管理Pod和ReplicaSet
  - 部署、滚动升级等
  - 典型应用： web服务、分部署服务等

- **Statefult： 部署有状态应用**
  - 有状态应用：每个Pod都独立运行，保持Pod启动顺序和唯一性，有唯一的网络标识符，持久存储、有序，比如mysql主从，主机名称固定，而且扩容以及升级等操作也是按照顺序进行的操作


- **DaemonSet： 部署守护进程**
  - DaemonSet 保证在每个Node 上都运行一个容器副本，常用来部署一些集群的日志、监控或者其他系统管理的应用，新加入的Node也同样运行在一个node里面
- **job： 一次性任务**
  - job负责批量处理短暂的一次性任务，它保证批处理任务的一个或多个pod成功结束
- **Cronjob**： 周期性定时任务


## Label

label 是附着到 object（例如pod） 上的键值对。 可以在创建 object 的时候指定，也可以在 object 创建后随时指定。 Label 的值对于系统并没有意义，只是对用户有意义。

一个 Label 是 key=value 的键值对， key 和 value 均由用户自行指定。

Label 可以附加到各种资源对象上，例如 Node 、 Pod 、Service 、RC 等， 一个资源对象可以定义任意数量的资源对象。 同一个 label 也可以被添加到任意数量的资源对象上去。

### 常用的 Label 标签：

- 版本标签：
  - "release": "stable" ,"release": "canary"
- 环境标签
  - "environment": "dev" ,"environment": "production" 
- 架构标签
  - "tier": "frontend" , "tier": "backend" , "tier": "middleware"
- 分区标签
  - "partition": "customerA" ,"partition": "customerB" 
- 质量管控标签
  - "track": "daily", "track": "weekly"


### Label语法及字符集


Label key 的组成：
- 不得超过 63 个字符
- 可以使用前缀，使用 / 分隔，前缀必须是DNS子域，不得超过 253个字符，系统中自动化组件必须指定前缀， `kubernetes.io/` 由kubernetes保留
- 起始必须是字母或数字、中间可以有连字符、下划线和 点


Label Value的组成
- 不超过63个字符
- 起始必须是字母或数字、中间可以有连字符、下划线和 点


### Label Selector

通过 label Selector 客户端/用户 可以指定一个 object 集合，通过 label selector 对 Object的集合进行操作


label-selector有量中类型
- equality-based(基于等式): 可以使用 `=` , `==` , `!=` 操作符，可以使用逗号分割多个表达式
- set-based（基于集合）： 可以使用 in 、 notin 、 ! 操作符，另外可以没有操作符直接写出某个 label 的 key ，表示过滤某个 key 的 object 而不管该 key 的 value 是何值， ! 表示没有该 label 的object


## Service

在 Kubernetes（K8s）中，​​Service（服务）​​ 是一种抽象层，用于定义一组 Pod 的逻辑集合以及访问它们的策略。它为动态变化的 Pod 提供稳定的访问入口，解决了 Pod IP 不固定、直接暴露 Pod 风险高等问题，是微服务架构中实现服务发现和负载均衡的核心组件。

Service 的核心是一组 iptables 或 ipvs 规划。



## Endpoints


- Service 通过标签选择器（Label Selector）关联一组 Pod，并自动生成对应的 Endpoints 对象，记录后端 Pod 的 IP 和端口。
- 当 Pod 变化时，Endpoints 会动态更新。

## DNS


为 kubernetes 集群内资源对象的访问提供域名解析，这样可以实现通过DNS名称，而非IP地址来访问服务：
- 实现集群内 Service 名称解析
- 实现集群内Pod内Container中应用访问互联网提供域名解析






# Kubernetes 核心概念之间的关系


# 基于Kubernetes 集群容器化应用的微服务