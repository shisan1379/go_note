
# 什么是进程

**进程（process）**，是一个具有一定独立功能的程序，是系统进行 **资源分配和调度** 的一个单位（一个基本单位）


- 进程是 **程序** 的 **一次执行**


# 进程的结构

- 控制块（Process Control Box 简称 PCB）

    - OS 根据 PCB来对进程进行控制和管理，进程的创建和撤销都是根据PCB来进行的
    - PCB 存储了一些数据： 程序计数器、进程状态、CPU暂存器、存储器管理、输入输出状态等信息
    - PCB 在新建进程时创建，并常驻内存，是进程实体的一部分，也是进程的唯一标识

- 数据段

    - 数据区域(data region): 全局和静态变量、进程执行期间使用的动态分配的内存
    - 堆栈区域(stack region): 存储活动过程调用的指令和本地变量

- 程序段

    - 文本区域(text region): 存储处理器执行的代码，二进制格式

    可被多个进程共享


![](https://raw.githubusercontent.com/shisan1379/img/main/img/20240331123028.png)


# 进程的特征

- 动态性：是程序实体的一次执行过程，由创建而生，由撤销而亡
- 并发性：多个进程同时段运行
- 独立性：独立资源分配
- 异步性：相互独立互不干扰

# 进程与线程

## 什么是线程

Thread 线程 - 也叫轻量级进程，
1. 线程必须包含在进程中，不能单独存在，
1. 线程是OS中运算调度的最小单位，
1. 线程可以并发执行
1. 线程共享进程的资源

## 为什么要引入进程

要提高 OS 的并发性


## 进程和线程对比

- 调度
    - `线程` 是调度的基本单位
    - 在同一个进程中线程的调度，不会引发进程的切换

- 拥有资源
    - 进程拥有资源，而线程(一般)不拥有资源，这样做是为了减少切换线程的开销
    - 同一个进程中的线程共享该进程的资源

- 并发性

    在多线程 OS 中 ，进程可以并发执行，线程也可以

- 系统开销
    - 创建和撤销进程：需要分配和回收相关资源，开销大，切换进程的成本较高
    - 相对而言，创建和撤销线程的成本较低，只需要保存少量寄存器内容，开销小

- 地址空间和其他资源
    - 进程的地址空间相互独立
    - 同一进程的线程间共享资源，但彼此互不可见

- 通信方面

    - 进程间通信需要同步或者互斥的帮助
    - 线程间可以直接读写数据段如全局变量来通信
    - 同一进程内的线程共享该进程资源，同步和通信更容易实现




总结

- 进程
    - 作为系统 **分配资源** 的基本单位
    - 可以包含多个线程，但至少有一个线程
    - 进程不是可执行的实体，真正执行的是线程

- 线程：是独立运行和独立调度的基本单位

- 引入进程的目的在于，使多道程序并发执行，提高系统的资源利用率和吞吐量
- 引入线程的目的在于，减少程序在并发的时空开销，提高系统的并发性，并且相对于进程降低了创建、撤销、切换的成本和难度


# 线程的实现方式



- 用户级线程 - User Level Thread ULT

- 内核级线程 - Kernel Levle Thread KLT





 




## 内核线程和用户线程的对比

- 创建
    - **用户线程**：一般是应用程序通过线程库创建和管理的，不依赖 内核，用户可以决定线程的生命周期
    - **内核线程**：内核线程是由操作系统内核创建和管理的，只能依靠内核管理
- 执行状态

    - **用户线程**: 用户线程只能运行在用户态，只能访问应用程序的资源，不能访问内核资源
    - **内核线程**：运行在内核态，可以访问所有资源，如文件系统、网络等

- 切换开销

    - **用户线程**： 用户线程的切换可以在用户态完成，不需要进入内核态因此开销较小
    - **内核线程**：内核线程的切换需要操作系统从用户态转变为内核态，完成后再返回用户态因此开销较大

- 生成数量限制
    - **用户线程**： 无限制
    - **内核线程**：内核级线程数量是有限的，因为操作系统内有一个线程表在控制，线程鼻癌存放在操作系统固定的表格空间或者堆栈空间

