# values.yaml - 完全非高可用配置

# -- Harbor 外部访问地址
externalURL: https://harbor.shisan.com

# -- 服务暴露配置
expose:
  type: ingress
  tls:
    enabled: true
    certSource: secret
    secret:
      secretName: harbor-tls
      notarySecretName: harbor-tls

  ingress:
    hosts:
      core: harbor.shisan.com
    className: "traefik"
    annotations:
      # 指定 entrypoints
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      # tls
      traefik.ingress.kubernetes.io/router.tls: "true"
      #traefik.ingress.kubernetes.io/router.middlewares: harbor-redirectscheme@kubernetescrd

# -- Harbor 管理员密码
harborAdminPassword: "admin@123"

# -- 持久化存储配置
persistence:
  enabled: true
  resourcePolicy: "keep"
  persistentVolumeClaim:
    registry:
      storageClass: "local-storage"
      accessMode: ReadWriteOnce
      size: 40Gi
    chartmuseum:
      storageClass: "local-storage"
      accessMode: ReadWriteOnce
      size: 10Gi
    jobservice:
      jobLog:
        storageClass: "local-storage"
        accessMode: ReadWriteOnce
        size: 2Gi
    database:
      storageClass: "local-storage"
      accessMode: ReadWriteOnce
      size: 5Gi
    redis:
      storageClass: "local-storage"
      accessMode: ReadWriteOnce
      size: 1Gi
    trivy:
      storageClass: "local-storage"
      accessMode: ReadWriteOnce
      size: 2Gi

# -- 数据库配置 - 单实例
database:
  internal:
    password: "admin@123"
  # 单实例配置
  replicas: 1
  nodeSelector:
    kubernetes.io/hostname: "node01"  # 指定部署到node01
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# -- Redis 配置 - 单实例
redis:
  internal:
    password: "admin@123"
  # 单实例配置
  replicas: 1
  nodeSelector:
    kubernetes.io/hostname: "node01"  # 指定部署到node01
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# -- Trivy 配置 - 单实例
trivy:
  enabled: true
  replicas: 1
  nodeSelector:
    kubernetes.io/hostname: "node01"  # 指定部署到node01
  ignoreUnfixed: true
  resources:
    requests:
      memory: "512Mi"
      cpu: "200m"
    limits:
      memory: "1Gi"
      cpu: "500m"

# -- Harbor 核心组件配置 - 全部单实例
core:
  secret: "admin@123"
  xsrfKey: "1653089a3fdf046455aaa16d793517f0"
  csrfKey: "6c22a4df267aa2c3ac81ac104c4d1660"  # 替换为你生成的 32 字符字符串
  replicas: 1
  nodeSelector:
    kubernetes.io/hostname: "node01"  # 指定部署到node01
  resources:
    requests:
      memory: "512Mi"
      cpu: "200m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

# -- 任务服务配置 - 单实例
jobservice:
  replicas: 1
  nodeSelector:
    kubernetes.io/hostname: "node01"  # 指定部署到node01
  jobLogger: "file"
  maxJobWorkers: 5
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# -- 注册表配置 - 单实例
registry:
  replicas: 1
  nodeSelector:
    kubernetes.io/hostname: "node01"  # 指定部署到node01
  credentials:
    username: "admin"
    password: "admin@123"
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# -- 功能组件配置 - 全部单实例
chartmuseum:
  enabled: true
  replicas: 1

portal:
  enabled: true
  replicas: 1

notary:
  enabled: false

# -- 完全禁用所有高可用特性
# 无负载均衡配置
# 无反亲和性配置
# 无多副本配置