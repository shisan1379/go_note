
# 安装
1. ubuntu22 安装 docker
   ```bash
   sudo apt install docker.io
    # 添加用户到 docker 组
   sudo usermod -aG docker $USER
   ```
2. 安装 docker
   ```bash
   sudo apt install docker-compose
   ```
3. 安装 kind
   
   <https://kind.sigs.k8s.io/docs/user/quick-start/#installation>

    ```bash
    [ $(uname -m) = x86_64 ] && curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.27.0/kind-linux-amd64

    chmod +x ./kind

    sudo mv ./kind /usr/local/bin/kind
    ```
4. 安装 kubectl
   1. 使用以下命令下载最新版本：
        ```bash
         curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
        ```
        下载指定版本
        ```bash
        curl -LO https://dl.k8s.io/release/v1.32.0/bin/linux/amd64/kubectl
        ```
   3. 验证
      
      下载 sha256 摘要
      ```bash
       curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl.sha256"
      ```
      将下载的 kubectl 与摘要进行比对
      ```bash
      echo "$(cat kubectl.sha256)  kubectl" | sha256sum --check
      ```
      如果有效，则输出为：
      ```bash
      kubectl: OK
      ```
   4. 安装 kubectl
      ```bash
      sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
      ```
   5. 测试
      ```bash
      kubectl version --client
      ```

# 使用kind


`kind`（Kubernetes IN Docker）是一个用于在本地 Docker 容器中运行 Kubernetes 集群的工具。它非常适合开发、测试和学习 Kubernetes。以下是 `kind` 的安装和使用指南。

---



##  **创建 Kubernetes 集群**
### 创建一个单节点集群
```bash
kind create cluster --name my-cluster
```
• `--name my-cluster`：指定集群名称（可选，默认为 `kind`）。

### 创建一个多节点集群
1. 创建一个配置文件（例如 `kind-config.yaml`）：
   ```yaml
   kind: Cluster
   apiVersion: kind.x-k8s.io/v1alpha4
   nodes:
     - role: control-plane
     - role: worker
     - role: worker
   ```

2. 使用配置文件创建集群：
   ```bash
   kind create cluster --config kind-config.yaml --name my-multi-node-cluster
   ```

外部网络访问
```bash
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
networking:
  # WARNING: It is _strongly_ recommended that you keep this the default
  # (127.0.0.1) for security reasons. However it is possible to change this.
  # 这里配置为本机地址
  apiServerAddress: "192.168.144.143"
  # By default the API server listens on a random open port.
  # You may choose a specific port but probably don't need to in most cases.
  # Using a random port makes it easier to spin up multiple clusters.
  apiServerPort: 6443

```


---
## 获取./kube/kubeconfig

```bash
kind get kubeconfig --name my-cluster
```

## **管理集群**
### 列出所有集群
```bash
kind get clusters
```

将 kubeconfig 保存到文件
```bash
kind get kubeconfig --name my-cluster > kubeconfig.yaml
```


### 删除集群
```bash
kind delete cluster --name my-cluster
```

### 访问集群
`kind` 会自动配置 `kubectl` 以访问新创建的集群。验证集群状态：
```bash
kubectl cluster-info
kubectl get nodes
```

---

## **加载本地镜像到集群**
`kind` 支持将本地 Docker 镜像加载到集群中，方便测试。

### 加载镜像
```bash
kind load docker-image my-image:latest --name my-cluster
```

---

## **导出集群日志**
如果集群出现问题，可以导出日志进行调试：
```bash
kind export logs --name my-cluster
```

---

## **高级配置**
### 自定义 Kubernetes 版本
在配置文件中指定 Kubernetes 版本：
```yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    image: kindest/node:v1.27.3
  - role: worker
    image: kindest/node:v1.27.3
```

### 暴露端口
将主机的端口映射到集群节点：
```yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    extraPortMappings:
      - containerPort: 30000
        hostPort: 8080
```

---

## **常见问题**
### 1. **Docker 权限问题**
如果出现 `permission denied` 错误，将当前用户添加到 `docker` 组：
```bash
sudo usermod -aG docker $USER
newgrp docker
```

### 2. **集群启动失败**
检查 Docker 是否运行：
```bash
docker ps
```
如果 Docker 未运行，启动它：
```bash
sudo systemctl start docker
```

### 3. **`kubectl` 无法访问集群**
确保 `kubectl` 已安装并配置正确：
```bash
kubectl version --client
```

---

## **卸载 `kind`**
1. 删除所有集群：
   ```bash
   kind delete clusters --all
   ```

2. 删除 `kind` 二进制文件：
   ```bash
   sudo rm /usr/local/bin/kind
   ```

---

通过以上步骤，你可以轻松使用 `kind` 在本地创建和管理 Kubernetes 集群。它非常适合开发和测试 Kubernetes 应用程序。