# 什么是Namespace

Namespace 是 Linux 内核的一项功能，该功能能够对**内核资源**进行**分区**。以便能给一组进程，分配资源。 Namespace 需要为资源和进程设置相同的 Namespace。这些 Namespace 引用了不同的资源。 资源包括 PID 、主机名 、 文件名 、 网络相关的进程

|             Namespace             |                   作用                   | 内核版本 |
| :-------------------------------: | :---------------------------------------: | -------- |
|            Mount（mnt)            |                隔离挂载点                | 2.4.19   |
|         Process ID（pid）         |                隔离进程Id                | 2.6.24   |
|          Network（net）          |          隔离网络设备、端口号等          | 2.6.29   |
| Interprocess Communication（ipc） | 隔离 System V IPC 和 POSIX message queues | 2.6.19   |
|       UTS Namespace（uts）       |             隔离主机名和域名             | 2.6.19   |
|      User Namespace（user）      |             隔离用户和用户组             | 3.8      |
| Control Group Namespace（cgroup） |            隔离 Cgroups 根目录            | 4.6      |
|          Time Namespace          |               隔离系统时间               | 5.6      |

虽然 Linux 内核提供了8种 Namespace，但是最新版本的 Docker 只使用了其中的前6 种，分别为Mount Namespace、PID Namespace、Net Namespace、IPC Namespace、UTS Namespace、User Namespace。


## Namespace 与进程之间的关系

1. **进程属于命名空间** ： 每个进程都会与多个不同的命名空间相关联。进程启动时，默认继承父进程的命名空间，但是可以通过 `系统调用` (如 clone()、unshare() 让进程进入新的命名空间)
2. **命名空间会影响进程的资源视图** ： 进程只能查看所属命名空间的资源，例如：

   1. PID NameSpace： 进程只能看到自己命名空间中的进程ID，这意味着一个进程在某个命名空间中可以是 PID 1，而在其他命名空间中 它的 PID 是不同的
   2. Network Namespace ： 进程只能访问自己命名空间内的网络设备和网络资源。这使得不同命名空间中的进程，可以使用不同的IP 地址、网络路由，而互不干扰
   3. Mount Namespace ： 进程可以在不同的文件系统视图中运行，这允许一个进程在自己的挂载点操作文件系统，而不会影响其他命名空间中的进程。

1. **命名空间隔离了进程的资源访问** ： 进程可以根据命名空间的类型被隔离，例如：在 User Namespace 中 进程可能以非特权用户运行，但在命名空间内部，它可以被视为超级用户(root) 。同样 IPC Namespace 隔离了进程间的通信资源，不同命名空间的进程无法互相发送信号或者访问共享的IPC资源
   
2. **命名空间是进程树的一部分** ： 每个进程都会有一个 **命名空间树**  ，通过 `proc` 文件系统可以查看每个进程所属的命名空间
   ```bash
   ls -l /proc/[PID]/ns/
   ```


## 资源与命名空间的关系

资源只能属于一个特定类型的命名空间

1. **进程** 只能属于一个 `PID Namespace`
2. **网络接口**只能属于一个 `Network Namespace`
3. **挂载点**只能属于一个 `Mout Namespace`
4. **IPC(进程间通信)**只能属于一个 `IPC Namespace`

每个特定的资源不能被多个命名空间共享，只能专属于某个命名空间

# Mount Namespace

