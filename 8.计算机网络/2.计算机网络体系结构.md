
# 常用的计算机网络体系结构


## OSI体系结构

为了使不同体系结构的计算机网络都能够互联，国际标准化组织于1977年成立了专门机构研究该问题，不久他们就提出了一个试图使各种计算机在世界范围内都能够互连成网的标准框架，也就是著名的“开放系统互连参考模型”，简称为OSI，OSI体系结构有时候我们也称之为OSI模型。


OSI是一个七层协议的体系结构：从下往上依次是物理层、数据链路层、网络层、运输层、会话层、表示层、应用层。



![alt text](image-29.png)



OSI试图达到一种理想境界，即全球计算机网络都遵循这个统一标准，因而全球的计算机将能够很方便地进行互连和交换数据。在20世纪80年代，许多大公司甚至一些国家的政府机构纷纷表示支持OSI。当时看来似乎在不久的将来全世界一定会按照OSI制定的标准来构造自己的计算机网络。

然而到了20世纪90年代初期，虽然整套的OSI国际标准都已经制定出来了，但由于基于TCP/IP 的互联网已抢先在全球相当大的范围成功地运行了，而与此同时却几乎找不到有什么厂家生产出符合OSI标准的商用产品。因此人们得出这样的结论：OSI 只获得了一些理论研究的成果，但在市场化方面则事与愿违地失败了。


现今规模最大的、覆盖全球的、基于TCP/IP的互联网并未使用OSI标准。


## 具有五层协议的体系结构



TCP/IP是一个四层的体系结构，它包含**应用层、运输层、网际层和网络接口层**（用网际层这个名字是强调这一层是为了解决不同网络的互连问题）。



OSI的七层协议体系结构概念清楚，理论也比较完整，但是太过于复杂不实用。TCP/IP体系结构不同，但是现在却得到了非常广泛的应用。

在学习计算机网络的原理时往往采取折中的办法，即综合OSI和TCP/IP 的优点，采用一种只有五层协议的体系结构，这样既简洁又能将概念阐述清楚。有时为了方便，也可把最底下两层称为网络接口层。


![alt text](image-30.png)


**应用层（application layer）**
> 应用层是体系结构中的最高层。应用层的任务时通过应用程序间的交互来完成特定的网络应用。**应用层协议**是应用进程间的通信的规则。对于不同的网络应用需要不同的协议。在互联网上应用层协议非常多，如： 系统域名DNS 、 HTTP协议 、 电子邮件的SMTP协议 等。 我们把应用层中交换的数据单元叫做 **报文(Message)**


**运输层（transport layer）**
> 运输层的任务就是负责向 **两台主机中进程之间的通信提供通用的数据传输服务**
运输层主要有以下两种协议
    1. **传输控制协议TCP（Transmission Control Protocol）**： 提供面向连接的、可靠的数据传输服务
    2. **用户数据协议UDP（User Datagram Protocol）**：提供无连接的，尽最大努力的数据传输服务（不保证数据的可靠性）


**网络层（network layer）**
> 主要作用是，**实现两个网络系统之间数据透明传输**，具体包括**路由选择。拥塞控制盒网际互联等**
> 在发送数据时，网络层把运输层产生的报文或用户数据分组并封包后进行传送。在 TCP/IP 体系中，由于网络层使用IP协议，因此分组也叫做 IP数据报 ，简称数据报
> 数据在经过网络层时会加上IP协议的头部



**数据链路层（data  link layer）**
> 两台主机之间的数据，总是在一段一段的链路上传送的，这就需要使用专门的链路层协议。在两个相邻的节点之间传送数据时，数据链路层将网络层交下来的 IP 数据组装成 **帧（framing）** ，在两个相邻节点的链路上传送帧


**物理层（physical layer）**
> 利用传输介质为数据链路层提供物理连接，实现比特流的透明传输
> **物理层上所传输的数据单位是 比特 bit**

![alt text](image-31.png)


1. 发送方-应用层 - 用户A发送报文
2. 发送方-传输层 - 在头部增加 TCP/UDP 包首部分
3. 发送方-网络层 - 在头部增加 IP包 部分
4. 发送方-数据链路层 - 在头部增加以太网网包首部（用于两个网络间的数据传送、路由选择、网际互联等）
5. 发送方-物理层 - 通过以太网电/光缆发送
6. 接收方-物理层 - 通过以太网电/光缆接收
7. 接收方-数据链路层 - 解析以太网首部
8. 接收方-网络层 - 解析 IP 包首部，并识别上一层为TCP
9. 接收方-传输层 - 解析 TCP 包首部
10. 接收方-应用层 - 用户B接收报文


# 物理层


物理层主要解决在**各种传输媒体上传输比特0和1的问题**，进而给数据链路层提供透明传输比特流的服务


由于传输媒体的种类太多（例如同轴电缆、光纤、无线电波等），物理连接方式也有很多例如点对点连接、广播连接等，因此物理层协议种类也比较多。但是物理层为了解决在各种传输媒体上传输比特0和1的问题，无论是那种物理层协议都需要满足主以下四个任务：

1. 机械特性： 指明接口所用接线器的**形状** 和尺寸，引脚数目和排列、固定和锁定装置
2. 电气特性：指明在接口电缆的各条线上出现的电压范围
3. 功能特性：指明某条线上出现的不同电平表示何种意义
4. 过程特性：指明对于不同功能的各种事件的出现顺序

### 传输媒体



#### 导引型传输媒体

**同轴电缆**

![alt text](image-32.png)

可以从上图看出同轴电缆的各层都是共圆心的，也就是同轴心的
同轴电缆有两种：
- 基带同轴电缆：数字传输，过去用于局域网
- 宽带同轴电缆：模拟传输，目前主要用于有线电视

同轴电缆价格较贵且布线不够灵活和方便，随着集线器的出现，在局域网领域基本上都是采用双绞线作为传输媒体

**双绞线**

双绞线是最常用的传输媒体，把两根互相绝缘的铜导线放在一起，然后按照一定规则绞合起来就构成了双绞线。


常用的双绞线包含八根铜导线，每两根绞合成一条双绞线，绞合组合如下：
- 蓝色线和蓝白双色线绞合
- 橙色线和橙白双色线绞合
- 绿色线和绿白双色线绞合
- 棕色先和棕白双色线绞合


绞合的作用：
- 抵御部分来自外界的电磁干扰
- 减少相邻导线的电磁干扰

根据有无屏蔽层，双绞线分为：无屏蔽双绞线和屏蔽双绞线

- 无屏蔽
  ![alt text](image-33.png)
- 屏蔽双绞线：在双绞线与外层绝缘封套之间有一个金属屏蔽层
  ![alt text](image-34.png)

常用的绞合线类别、带宽及典型应用


![alt text](image-35.png)




光纤

![alt text](image-36.png)
光纤的优点
- 通信容量大(25000~30000GHz的带宽)
- 传输损耗小，远距离传输时更加经济。
- 抗雷电和电磁干扰性能好。这在大电流脉冲干扰的环境下尤为重要。
- 无串音干扰，保密性好，不易被窃听。
- 体积小，重量轻。

#### 非导引型传输媒体：非导引型传输媒体是指自由空间

- 无线电波
- 微波
- 红外线
- 可见光

# 数据链路层


## 数据链路层在网络体系结构中所处的地位


主机H1给主机H2发送数据，中间要经过三个路由器、电话网、局域网、广域网等多种网络。
![alt text](image-39.png)


详细过程如下


![alt text](image-40.png)

要发送的数据按照逐层进行传递。

当我们研究数据链路层时，我们可以只关心数据链路层，而不考虑其他各层。我们可以想象，数据只在数据链路层从左至右沿水平方向传送。从数据链路层来看，主机H1到主机H2 的通信可以看作是在4段不同的链路上的通信所组成的。


![alt text](image-41.png)


所谓的**链路(Link)就是从一个结点到相邻结点的一段物理线路，而中间没有任何其他的交换结点。要在链路上传输数据，仅有链路还不够，还需要一些通信协议来控制这些数据的传输，如果把实现这些协议的硬件和软件加到链路上就构成了数据链路（Data Link）**

在数据链路上传输的数据包，又称为帧。（数据链路层是以帧作为单位传输和处理的）

![alt text](image-42.png)
> 注意：结点就是网络中的一台主机。

数据链路层的协议有很多种，但是有三个基本问题是共同的。这三个基本问题就是：封装成帧、透明传输和差错检测。

### 封装成帧


封装成帧是指数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧。


**帧头和帧尾中包含有重要的控制信息**


![alt text](image-43.png)



帧头和帧尾的作用之一就是帧定界，例如：PPP帧的第一个字节和最后一个字节就是帧定界，通过这两个字节就能够从物理层交付的比特流中提取出一个一个的帧。


![alt text](image-44.png)



**并不是每种数据链路层协议的帧都包含有帧定界标志**，例如MAC帧在帧头和帧尾中是没有包含帧定界的标志的， 那么接收方是如何从物理层交付的比特流中提取出一个个的以太网帧的呢？


- 第一步：数据链路层封装好MAC帧，将其交付给物理层
- 第二步：物理层在MAC帧的前面添加8字节的前导码，前导码的前7个字节为前同步码，其作用是使接收方的时钟同步，之后的1个字节为帧开始定界符，表明其后紧跟着的就是MAC帧。


![alt text](image-45.png)



### 透明传输

透明传输是指数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样。

当使用透明传输时，数据帧中的数据是帧定界标志时，发送端的数据链路层如何处理？

**情况一：当物理链路提供的是面向字符流的传输服务时（物理链路以字符为单位传输数据）**
![alt text](image-46.png)

解决方式：数据链路层在交付给物理层时，会对帧进行扫描，首先扫描到 `SOH` ，然后将每扫描到一个 `SOH` 和 `EOT` 就在前面加上转义字符 `ESC` ，直到扫描到最后一个 `EOT`。这种方式称之为 ： `字节填充（byte stuffing）` 或 `字符填充（character stuffing）`

![alt text](image-47.png)

**情况二：当物理链路提供的是面向比特的传输服务时（物理链路以比特为单位传输数据）**
![alt text](image-48.png)

在数据发送钱采用 **比特填充法** ：对数据进行扫描，每五个连续的比特1后面就插入一个 比特0.

![alt text](image-49.png)


为了提高帧的传输效率，应当使帧的数据部分的长度尽可能大些。

考虑到差错控制等多种因素。每一种数据链路层协议都规定了帧的数据部分的长度上限，即最大传送单元 **MTU（Maximum Transfer Unit）**


![alt text](image-50.png)



### 差错校验










实际的通信链路都不是理想的，比特流在传输过程中由于受到各种干扰可能会产生差错: 1可能会变成0,而0也可能变成1。这称为比特差错，或者称为误码。

![alt text](image-51.png)


一段时间内，传输错误的比特占所传输比特总数的比率称为**误码率（Bit Error Rate）**


、在封装好的帧中利用若干个字节表示帧校验序列FCS字段。FCS :Frame Check Sequence(帧校验序列)。FCS字段由一些差错校验算法计算得出，常用的校验算法为：循环冗余校验CRC(Cyclic Redundancy Check)。

接收方在接收到数据后计算出一个FCS，然后将计算得出的FCS与接收到的数据帧中的FCS进行比较。


![alt text](image-52.png)


由于判断FCS是否正确只能检测出帧在传输过程中出现了差错，但并不能定位错误，因此无法纠正错误。接收方可以通过检错重传方式来纠正传输中的差错,或者仅仅是丢弃检测到差错的帧，这取决于数据链路层向其上层提供的是可靠传输服务还是不可靠传输服务。


### 以太网
